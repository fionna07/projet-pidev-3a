{% extends 'base.html.twig' %}

{% block title %}Offres d'Emploi{% endblock %}

{% block body %}
<div class="container mt-4">
    <h1 class="mb-4">Offres d'Emploi</h1>
    
    <!-- Bouton Ajouter Offre -->
    <div class="d-flex justify-content-end mb-3">
        <a href="{{path('offre_ajouter')}}" class="btn btn-primary">
            <i class="fas fa-plus"></i> Ajouter une Offre
        </a>
    </div>
    
    <div class="row">
        {% for offre in offres %}
            <div class="col-md-4 mb-4">
                <div class="card position-relative shadow-sm">
                    <!-- Date de publication -->
                    <div class="position-absolute top-0 start-0 m-2 text-muted small" style="margin-bottom: 10px;">
					Publié le: {{ offre.datePublication|date('d/m/Y') }}
					</div>

                    
                    <!-- Statut -->
                    <div class="position-absolute top-0 end-0 m-2">
					{% if offre.status == 'actif' %}
						<span class="badge bg-success rounded-circle d-inline-block" style="width: 15px; height: 15px; margin: 5px;"></span>
					{% else %}
						<span class="badge bg-danger rounded-circle d-inline-block" style="width: 15px; height: 15px; margin: 5px;"></span>
					{% endif %}
					</div>

                    
                    <div class="card-body" style="padding-top: 20px;">
					<h5 class="card-title fw-bold">{{ offre.titre }}</h5>

                        <!-- Dates -->
                        <p class="mb-1"><strong>Date de début:</strong> {{ offre.dateDebut|date('d/m/Y') }}</p>
                        <p class="mb-1"><strong>Date de fin estimée:</strong> {{ offre.dateFinEstimee|date('d/m/Y') }}</p>
                        
                        <!-- Compétences requises -->
                        <p><strong>Compétences Requises:</strong></p>
                        <div class="mt-2">
						<p><strong>Compétences Requises:</strong></p>
						<div class="d-flex flex-wrap gap-2">
							{% for competence in offre.competencesRequises|split(',') %}
								<span class="badge bg-secondary text-white px-3 py-2 rounded-pill">{{ competence|trim }}</span>
							{% endfor %}
						</div>
						</div>

                        
                        <!-- Salaire -->
                        <p class="mt-2"><strong>Salaire:</strong> {{ offre.salaire }} TND</p>
                    </div>
                    
                    <!-- Actions -->
                    <div class="card-footer d-flex justify-content-between">
                    <button type="button" class="btn btn-info btn-sm" data-bs-toggle="modal" data-bs-target="#offreModal{{ offre.id }}">
					<i class="fas fa-eye"></i> Détails
					</button>

                    <button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#editOffreModal{{ offre.id }}">
					<i class="fas fa-edit"></i> Modifier
					</button>

                        <form method="post" action="{{ path('offre_supprimer', {'id': offre.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer cette offre ?');">
						<button class="btn btn-danger btn-sm">
							<i class="fas fa-trash"></i> Supprimer
						</button>
					</form>

                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
	<!-- Modals pour Détails et Modification -->
	{% for offre in offres %}
	<!-- Modal Détails -->
	<div class="modal fade" id="offreModal{{ offre.id }}" tabindex="-1" aria-labelledby="offreModalLabel{{ offre.id }}" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title fw-bold" id="offreModalLabel{{ offre.id }}">{{ offre.titre }}</h5>
				</div>
				<div class="modal-body">
					<p class="text-muted small">Publié le {{ offre.datePublication|date('d/m/Y H:i') }}</p> <!-- Date avec heure -->

					<p><strong>Description :</strong></p>
					<p>{{ offre.description }}</p>

					<p><strong>Nombre de postes :</strong> {{ offre.nombrePostes }}</p>

					<p><strong>Date de début :</strong> {{ offre.dateDebut|date('d/m/Y H:i') }}</p> <!-- Date avec heure -->

					<p><strong>Date de fin estimée :</strong> {{ offre.dateFinEstimee|date('d/m/Y') }}</p> <!-- Date sans heure -->

					<p><strong>Compétences Requises :</strong></p>
					<div class="d-flex flex-wrap gap-2">
						{% for competence in offre.competencesRequises|split(',') %}
							<span class="badge bg-secondary text-white px-3 py-2 rounded-pill">{{ competence|trim }}</span>
						{% endfor %}
					</div>

					<p class="mt-2"><strong>Salaire :</strong> {{ offre.salaire }} TND</p>

					<p><strong>Localisation :</strong> {{ offre.localisation }}</p>
				</div>
			</div>
		</div>
	</div>
	<div class="modal fade" id="editOffreModal{{ offre.id }}" tabindex="-1" aria-labelledby="editOffreModalLabel{{ offre.id }}" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title fw-bold" id="editOffreModalLabel{{ offre.id }}">Modifier l'Offre</h5>
            </div>
            <div class="modal-body">
                <form method="post" action="{{ path('offre_edit', {'id': offre.id}) }}">
                    <!-- Titre -->
                    <div class="mb-3">
                        <label for="titre{{ offre.id }}" class="form-label">Titre</label>
                        <input type="text" class="form-control" id="titre{{ offre.id }}" name="titre" value="{{ offre.titre }}" required>
                    </div>

                    <!-- Description -->
                    <div class="mb-3">
                        <label for="description{{ offre.id }}" class="form-label">Description</label>
                        <textarea class="form-control" id="description{{ offre.id }}" name="description" rows="3" required>{{ offre.description }}</textarea>
                    </div>

                    <!-- Nombre de postes -->
                    <div class="mb-3">
                        <label for="nombrePostes{{ offre.id }}" class="form-label">Nombre de Postes</label>
                        <input type="number" class="form-control" id="nombrePostes{{ offre.id }}" name="nombrePostes" value="{{ offre.nombrePostes }}" required>
                    </div>

                    <!-- Date de publication -->
                    <div class="mb-3">
                        <label for="datePublication{{ offre.id }}" class="form-label">Date de Publication</label>
                        <input type="datetime-local" class="form-control" id="datePublication{{ offre.id }}" name="datePublication" value="{{ offre.datePublication|date('Y-m-d\TH:i') }}" required>
                    </div>

                    <!-- Date de début -->
                    <div class="mb-3">
                        <label for="dateDebut{{ offre.id }}" class="form-label">Date de Début</label>
                        <input type="datetime-local" class="form-control" id="dateDebut{{ offre.id }}" name="dateDebut" value="{{ offre.dateDebut|date('Y-m-d\TH:i') }}" required>
                    </div>

                    <!-- Date de fin estimée -->
                    <div class="mb-3">
                        <label for="dateFinEstimee{{ offre.id }}" class="form-label">Date de Fin Estimée</label>
                        <input type="date" class="form-control" id="dateFinEstimee{{ offre.id }}" name="dateFinEstimee" value="{{ offre.dateFinEstimee|date('Y-m-d') }}" required>
                    </div>

                    <!-- Compétences Requises -->
                    <div class="mb-3">
                        <label for="competencesRequises{{ offre.id }}" class="form-label">Compétences Requises (séparées par des virgules)</label>
                        <input type="text" class="form-control" id="competencesRequises{{ offre.id }}" name="competencesRequises" value="{{ offre.competencesRequises }}">
                    </div>

                    <!-- Salaire -->
                    <div class="mb-3">
                        <label for="salaire{{ offre.id }}" class="form-label">Salaire</label>
                        <input type="number" class="form-control" id="salaire{{ offre.id }}" name="salaire" value="{{ offre.salaire }}" required>
                    </div>

                    <!-- Localisation -->
                    <div class="mb-3">
                        <label for="localisation{{ offre.id }}" class="form-label">Localisation</label>
                        <input type="text" class="form-control" id="localisation{{ offre.id }}" name="localisation" value="{{ offre.localisation }}" required>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                        <button type="submit" class="btn btn-primary">Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
	</div>

	{% endfor %}



</div>
{% endblock %}
