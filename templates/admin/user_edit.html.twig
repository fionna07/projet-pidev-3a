{% extends 'baseBack.html.twig' %}

{% block title %}Modifier un utilisateur{% endblock %}

{% block content %}
    <div class="container mt-5">
        <div class="card shadow-lg p-4 mx-auto" style="max-width: 600px;">
            <div class="card-header text-white text-center py-3" style="background-color: #4CAF50; border-top-left-radius: 10px; border-top-right-radius: 10px;">
                <h2><i class="bi bi-person-plus-fill me-2"></i>Modifier un utilisateur</h2>
            </div>

            {{ form_start(form, {'attr': {'novalidate': 'novalidate'}, 'method': 'POST'}) }}

            <!-- Aperçu de l'image actuelle ou image par défaut -->
            <div class="text-center mb-3">
                {% if user.image %}
                    <img id="preview-image" src="{{ asset(user.image) }}" alt="Aperçu" class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
                {% else %}
                    <img id="preview-image" src="https://via.placeholder.com/150" alt="Aperçu" class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
                {% endif %}
            </div>

            <!-- Champ d'upload de l'image -->
            <div class="mb-3">
                {{ form_label(form.image, null, {'label_attr': {'class': 'fw-bold'}}) }}
                {{ form_widget(form.image, {'attr': {'class': 'form-control', 'onchange': 'previewFile()'}}) }}
                {{ form_errors(form.image) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.email, null, {'label_attr': {'class': 'fw-bold'}}) }}
                {{ form_widget(form.email, {'attr': {'class': 'form-control'}}) }}
                {{ form_errors(form.email) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.roles, null, {'label_attr': {'class': 'fw-bold'}}) }}
                {{ form_widget(form.roles, {'attr': {'class': 'form-control'}}) }}
                {{ form_errors(form.roles) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.adresse, null, {'label_attr': {'class': 'fw-bold'}}) }}
                {{ form_widget(form.adresse, {'attr': {'class': 'form-control'}}) }}
                {{ form_errors(form.adresse) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.plainPassword, null, {'label_attr': {'class': 'fw-bold'}}) }}
                {{ form_widget(form.plainPassword, {'attr': {'class': 'form-control'}}) }}
                {{ form_errors(form.plainPassword) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.firstName, null, {'label_attr': {'class': 'fw-bold'}}) }}
                {{ form_widget(form.firstName, {'attr': {'class': 'form-control'}}) }}
                {{ form_errors(form.firstName) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.lastName, null, {'label_attr': {'class': 'fw-bold'}}) }}
                {{ form_widget(form.lastName, {'attr': {'class': 'form-control'}}) }}
                {{ form_errors(form.lastName) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.dateNaissance, null, {'label_attr': {'class': 'fw-bold'}}) }}
                {{ form_widget(form.dateNaissance, {'attr': {'class': 'form-control'}}) }}
                {{ form_errors(form.dateNaissance) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.dateCreation, null, {'label_attr': {'class': 'fw-bold'}}) }}
                {{ form_widget(form.dateCreation, {'attr': {'class': 'form-control', 'disabled': 'disabled'}}) }}
            </div>

            <div class="mb-3">
                {{ form_label(form.numTel, null, {'label_attr': {'class': 'fw-bold'}}) }}
                {{ form_widget(form.numTel, {'attr': {'class': 'form-control'}}) }}
                {{ form_errors(form.numTel) }}
            </div>

            <div class="d-flex justify-content-center gap-3">
                <button type="submit" class="btn btn-success px-4">Enregistrer</button>
                <a href="{{ path('admin_users') }}" class="btn btn-secondary px-4">Retour</a>
            </div>

            {{ form_end(form) }}
        </div>
    </div>

    <script>
        function previewFile() {
            const preview = document.getElementById('preview-image');
            const file = document.querySelector('input[type=file]').files[0];
            const reader = new FileReader();

            reader.onloadend = function () {
                preview.src = reader.result;
            }

            if (file) {
                reader.readAsDataURL(file);
            }
        }
    </script>
{% endblock %}
