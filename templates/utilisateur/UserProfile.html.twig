{% extends 'base.html.twig' %}

{% block title %}Profil de {{ UserDetail.firstName }} {{ UserDetail.lastName }}{% endblock %}

{% block body %}

<div class="container mt-5">
    <div class="card shadow-lg rounded-lg p-5">
        <div class="row">

            <!-- üìå Partie Gauche : Photo de Profil + Statut -->
            <div class="col-md-4 text-center">
                {# V√©rifie si l'utilisateur a une image #}
                {% if UserDetail.image %}
                    <img src="{{ asset(UserDetail.image) }}" alt="Photo de profil"
                         class="rounded-circle border border-primary shadow-lg mb-4" width="200" height="200">
                {% else %}
                    <img src="{{ asset('uploads/default-profile.png') }}" alt="Photo par d√©faut"
                         class="rounded-circle border border-primary shadow-lg mb-4" width="200" height="200">
                {% endif %}

                <!-- ‚úÖ Statut du compte -->
                <div class="mt-3">
                    {% if UserDetail.status %}
                        <span class="badge bg-success"><i class="fas fa-check-circle"></i> Actif</span>
                    {% else %}
                        <span class="badge bg-danger"><i class="fas fa-times-circle"></i> Inactif</span>
                    {% endif %}
                </div>
            </div>

            <!-- üìå Partie Droite : Informations Utilisateur -->
            <div class="col-md-8">
                <h2 class="text-dark">{{ UserDetail.firstName }} {{ UserDetail.lastName }}</h2>
                <p class="text-muted mb-3"><i class="fas fa-envelope"></i> {{ UserDetail.email }}</p>

                <hr>

                <div class="row">
                    <div class="col-md-6">
                        <p><strong>Date de naissance :</strong> {{ UserDetail.dateNaissance|date('d/m/Y') }}</p>
                        <p><strong>Adresse :</strong> {{ UserDetail.adresse }}</p>
                        <p><strong>T√©l√©phone :</strong> {{ UserDetail.numTel }}</p>
                    </div>
                </div>
                

                <!-- üìå Boutons d'actions -->
                <div class="d-flex justify-content-end mt-4">
    <!-- Bouton Modifier -->
    <button class="btn btn-outline-warning me-2" data-bs-toggle="modal" data-bs-target="#editProfileModal">
        <i class="fas fa-edit"></i> Modifier
    </button>


    <!-- Bouton D√©sactiver avec couleur marron -->
    <button type="button" class="btn btn-outline-warning" data-bs-toggle="modal" data-bs-target="#disableAccountModal">
        D√©sactiver
    </button>

    <!-- Bouton Supprimer avec couleur orange -->
    <a href="{{ path('app_delete_account') }}" class="btn btn-outline-warning ms-2">
        <i class="fas fa-trash"></i> Supprimer
    </a>
</div>

            </div>
        </div>
    </div>
</div>
<div class="container mt-5">
    <div class="row">
        <!-- Section des cartes de profil √† gauche -->
        <div class="col-md-8">
            <div class="row text-center">
                <!-- Card 1 : Suivi des cultures -->
                <div class="col-md-3 mb-4">
                    <div class="card shadow-sm border-light rounded p-3">
                        <i class="fas fa-seedling fa-3x text-success mb-3"></i>
                        <h5 class="card-title text-dark">Suivi des cultures</h5>
                        <p class="card-text text-muted">Suivez la croissance de vos cultures gr√¢ce √† des outils d'analyse intelligents.</p>
                    </div>
                </div>

                <!-- Card 2 : Gestion des ressources -->
                <div class="col-md-3 mb-4">
                    <div class="card shadow-sm border-light rounded p-3">
                        <i class="fas fa-tint fa-3x text-primary mb-3"></i>
                        <h5 class="card-title text-dark">Gestion des ressources</h5>
                        <p class="card-text text-muted">Optimisez l'utilisation de l'eau et des ressources naturelles avec des syst√®mes intelligents.</p>
                    </div>
                </div>

                <!-- Card 3 : Pr√©visions m√©t√©orologiques -->
                <div class="col-md-3 mb-4">
                    <div class="card shadow-sm border-light rounded p-3">
                        <i class="fas fa-cloud-sun fa-3x text-warning mb-3"></i>
                        <h5 class="card-title text-dark">Pr√©visions m√©t√©orologiques</h5>
                        <p class="card-text text-muted">Recevez des alertes m√©t√©o pr√©cises pour planifier vos activit√©s agricoles.</p>
                    </div>
                </div>

                <!-- Card 4 : March√© des produits -->
                <div class="col-md-3 mb-4">
                    <div class="card shadow-sm border-light rounded p-3">
                        <i class="fas fa-leaf fa-3x text-info mb-3"></i>
                        <h5 class="card-title text-dark">March√© des produits</h5>
                        <p class="card-text text-muted">Acc√©dez √† une plateforme pour vendre vos produits directement aux consommateurs.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section affich√©e √† droite des cartes (par exemple, un panneau lat√©ral avec des fonctionnalit√©s suppl√©mentaires) -->
        <div class="col-md-4">
            <div class="card shadow-sm border-light rounded p-3">
                <h5 class="text-dark">Fonctionnalit√©s suppl√©mentaires</h5>
                <ul class="list-group list-group-flush">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Partage de bonnes pratiques
                        <i class="fas fa-share-alt text-success"></i>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Suivi des performances
                        <i class="fas fa-chart-line text-danger"></i>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Agriculture de pr√©cision
                        <i class="fas fa-wrench text-primary"></i>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        √âducation et formations
                        <i class="fas fa-book text-info"></i>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

<!-- MODAL : Modification du profil -->

<div class="modal fade" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <!-- En-t√™te du modal avec une couleur de fond et des ic√¥nes -->
            <div class="modal-header bg-success text-white d-flex align-items-center p-3 border-bottom">
                <h5 class="modal-title fw-bold mb-0" id="editProfileModalLabel">Modifier mon profil</h5>
                <button type="button" class="btn-close ms-auto p-2" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <!-- Corps du modal avec fond clair -->
            <div class="modal-body bg-light p-4">
                {{ form_start(form, {'attr': {'novalidate': 'novalidate','enctype': 'multipart/form-data'}}) }}
 {% for message in app.flashes('error') %}
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
{% endfor %}


                <!-- Section de l'image de profil -->
                <div class="text-center mb-4">
                    <label for="imageUpload" class="cursor-pointer">
                        <img 
                            id="imagePreview" 
                            src="{{ UserDetail.image ? UserDetail.image : asset('img/default-avatar.png') }}" 
                            class="rounded-circle img-thumbnail border border-2 border-primary shadow-sm" 
                            style="width: 150px; height: 150px; object-fit: cover;" 
                            alt="Image de profil"
                        >
                    </label>
                    <input 
                        type="file" 
                        class="d-none" 
                        id="imageUpload" 
                        name="{{ form.image.vars.full_name }}" 
                        accept="image/*" 
                        onchange="previewImage(this)"
                    >
                    {{ form_widget(form.image, {'attr': {'class': 'd-none'}}) }}
             
                    <div class="text-danger small">
                        {{ form_errors(form.image) }}
                    </div>
    
                </div>

                <!-- Afficher les r√¥les sous l'image -->
                <div class="text-center mb-4">
                    <h6 class="text-muted fw-bold mb-2">Votre R√¥le</h6>
                    <p class="mb-0">
                        {% if UserDetail.roles|length > 0 %}
                            {% for role in UserDetail.roles %}
                                <span class="d-flex align-items-center justify-content-center mb-2">
                                    {% if role == 'ROLE_AGRICULTEUR' %}
                                        <i class="fas fa-seedling me-2 text-success"></i>
                                        Vous √™tes un agriculteur.
                                    {% elseif role == 'ROLE_FOURNISSEUR' %}
                                        <i class="fas fa-truck me-2 text-warning"></i>
                                        Vous √™tes un fournisseur.
                                    {% elseif role == 'ROLE_CLIENT' %}
                                        <i class="fas fa-user-circle me-2 text-primary"></i>
                                        Vous √™tes un client.
                                    {% elseif role == 'ROLE_EMPLOYE' %}
                                        <i class="fas fa-briefcase me-2 text-info"></i>
                                        Vous √™tes un employ√©.
                                    {% elseif role == 'ROLE_VISITEUR' %}
                                        <i class="fas fa-eye me-2 text-muted"></i>
                                        Vous √™tes un visiteur.
                                    {% endif %}
                                </span>
                            {% endfor %}
                        {% else %}
                            Aucun r√¥le attribu√©. Veuillez contacter l'administrateur pour une attribution de r√¥le.
                        {% endif %}
                    </p>
                </div>

                <!-- Section des informations personnelles -->
                <div class="row mb-3">
                    <h6 class="text-muted fw-bold mb-2">Informations personnelles</h6>
                    <div class="col-md-6">
                        {{ form_label(form.firstName, 'Pr√©nom') }}
                        {{ form_widget(form.firstName, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
                        
                            <div class="text-danger small">
                            {{ form_errors(form.firstName) }}
                            </div>
                                             
                        <div class="mb-3">
                        {{ form_label(form.lastName, 'Nom') }}
                        {{ form_widget(form.lastName, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
                      
                            <div class="text-danger small">{{ form_errors(form.lastName) }}</div>
                      
                        </div>
                        <div class="mb-3">
                                    {{ form_label(form.dateNaissance, 'Date de naissance') }}
                                    {{ form_widget(form.dateNaissance, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
                                
                                        <div class="text-danger small">{{ form_errors(form.dateNaissance) }}</div>
                                  
                   </div>                  
                    </div>
                   <div class="col-md-6">
        <div class="mb-3">
            {{ form_label(form.email, 'Adresse e-mail') }}
            {{ form_widget(form.email, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
         
                <div class="text-danger small">{{ form_errors(form.email) }}</div>
      
        </div>
        <div class="mb-3">
            {{ form_label(form.numTel, 'Num√©ro de t√©l√©phone') }}
            {{ form_widget(form.numTel, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
     
                <div class="text-danger small">{{ form_errors(form.numTel) }}</div>
         
        </div>
        <div class="mb-3">
            {{ form_label(form.adresse, 'Adresse') }}
            {{ form_widget(form.adresse, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
       
                <div class="text-danger small">{{ form_errors(form.adresse) }}</div>
         
        </div>
    </div>
                </div>

                <!-- Section du mot de passe -->
                <div class="form-group mb-4">
                    <div class="form-check d-flex align-items-center">
                        <label for="changer_mdp" class="form-check-label text-success me-2" data-bs-toggle="collapse" href="#password-collapse" role="button" aria-expanded="false" aria-controls="password-collapse">
                            <i class="fas fa-lock"></i> Changer mon mot de passe
                        </label>
                        <i class="fas fa-chevron-down" id="password-toggle-icon"></i>
                    </div>
                </div>

              <div class="collapse" id="password-collapse">
             <div class="border rounded p-3 mt-2 shadow-sm">
                <div class="mb-3">
            <label class="form-label fw-bold">Nouveau mot de passe</label>
            {{ form_widget(form.password, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
         
                <div class="text-danger small">
                    {{ form_errors(form.password) }}
                </div>
        
        </div>
        <div class="mb-3">
            <label class="form-label fw-bold">Confirmer le mot de passe</label>
            {{ form_widget(form.confirmPassword, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
          
                <div class="text-danger small">
                    {{ form_errors(form.confirmPassword) }}
                </div>
                
                    </div>
                </div>
            </div>
                <form method="post" action="{{ path('app_edit_profile') }}" enctype="multipart/form-data">
                  
                    <div class="text-end mt-4">
                        <button type="submit" class="btn btn-success btn-lg rounded-pill shadow-sm">
                            Sauvegarder
                        </button>
                    </div>
                </form>      
              {{ form_end(form) }}
            </div>
        </div>
    </div>
</div>


<!-- Modal pour choisir la dur√©e -->
<div class="modal fade" id="disableAccountModal" tabindex="-1" aria-labelledby="disableAccountModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="disableAccountModalLabel">D√©sactiver mon compte</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
            </div>
            <div class="modal-body">
   <form id="disableAccountForm" method="POST" action="{{ path('app_disable_account') }}">
    <label for="duration">Combien de temps souhaitez-vous d√©sactiver votre compte ?</label>
    <select class="form-control" name="duration" id="duration">
        <option value="1">1 jour</option>
        <option value="7">1 semaine</option>
        <option value="30">1 mois</option>
        <option value="permanent">Ind√©finiment</option>
    </select>

    <input type="hidden" name="_csrf_token" value="{{ csrf_token('disable_account') }}">
</form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Annuler</button>
                <button type="submit" class="btn btn-danger" form="disableAccountForm">Confirmer</button>
            </div>
        </div>
    </div>
</div>
<!-- Script pour l'aper√ßu de l'image -->
<script>
    function previewImage(input) {
        const preview = document.getElementById('imagePreview');
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

  
    document.addEventListener('DOMContentLoaded', () => {
        const imagePreview = document.getElementById('imagePreview');
        const imageUpload = document.getElementById('imageUpload');

        if (imagePreview && imageUpload) {
            imagePreview.addEventListener('click', () => {
                imageUpload.click();
            });
        }
    });
    </script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const toggleButton = document.querySelector('[href="#password-collapse"]');
    const icon = document.getElementById('password-toggle-icon');
    const collapseSection = document.getElementById('password-collapse');

    if (toggleButton && icon && collapseSection) {
        // G√©rer le clic sur le bouton principal
        toggleButton.addEventListener('click', () => {
      
            const isCollapsed = toggleButton.getAttribute('aria-expanded') === 'false';
            icon.classList.toggle('fa-chevron-up', !isCollapsed); 
            icon.classList.toggle('fa-chevron-down', isCollapsed); 
        });

        icon.addEventListener('click', (event) => {
            event.stopPropagation(); 
        
            if (collapseSection.classList.contains('show')) {
            
                toggleButton.setAttribute('aria-expanded', 'false');
                collapseSection.classList.remove('show');
                icon.classList.remove('fa-chevron-up'); 
                icon.classList.add('fa-chevron-down'); 
            } else {
               
                toggleButton.setAttribute('aria-expanded', 'true');
                collapseSection.classList.add('show');
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up'); 
            }
        });
    }
});
    

{% endblock %}

