{% extends 'base.html.twig' %}

{% block title %}Modifier mon profil{% endblock %}

{% block body %}
<div class="container mt-4">
    <h2 class="mb-4">Modifier mon profil</h2>

 

    <div class="card">
        <div class="card-body">
            

{{ form_start(form, {'method': 'POST', 'attr': {'novalidate': 'novalidate', 'enctype': 'multipart/form-data'}}) }}{% if form.vars.errors|length > 0 %}
    <div class="alert alert-danger">
        <ul>
            {% for error in form.vars.errors %}
                <li>{{ error.message }}</li>
            {% endfor %}
        </ul>
    </div>
{% endif %}
            <!-- Section de l'image de profil -->
            <div class="text-center mb-4">
                <label for="imageUpload" class="cursor-pointer">
                   <img 
                        id="imagePreview" 
                        src="{{ user.image ?: asset('images/default-profile.png') }}" 
                        class="rounded-circle img-thumbnail border border-2 border-primary shadow-sm" 
                        style="width: 150px; height: 150px; object-fit: cover;" 
                        alt="Image de profil"
                    >

                </label>
                <input 
                    type="file" 
                    class="d-none" 
                    id="imageUpload" 
                    name="{{ form.image.vars.full_name }}" 
                    accept="image/*" 
                    onchange="previewImage(this)"
                >
                {{ form_widget(form.image, {'attr': {'class': 'd-none'}}) }}

                <div class="text-danger small">
                    {{ form_errors(form.image) }}
                </div>
            </div>

            <!-- Afficher les rôles sous l'image -->
            <div class="text-center mb-4">
                <h6 class="text-muted fw-bold mb-2">Votre Rôle</h6>
                <p class="mb-0">
                    {% if user.roles|length > 0 %}
                        {% for role in user.roles %}
                            <span class="d-flex align-items-center justify-content-center mb-2">
                                {% if role == 'ROLE_AGRICULTEUR' %}
                                    <i class="fas fa-seedling me-2 text-success"></i> Vous êtes un agriculteur.
                                {% elseif role == 'ROLE_FOURNISSEUR' %}
                                    <i class="fas fa-truck me-2 text-warning"></i> Vous êtes un fournisseur.
                                {% elseif role == 'ROLE_CLIENT' %}
                                    <i class="fas fa-user-circle me-2 text-primary"></i> Vous êtes un client.
                                {% elseif role == 'ROLE_EMPLOYE' %}
                                    <i class="fas fa-briefcase me-2 text-info"></i> Vous êtes un employé.
                                {% elseif role == 'ROLE_VISITEUR' %}
                                    <i class="fas fa-eye me-2 text-muted"></i> Vous êtes un visiteur.
                                {% endif %}
                            </span>
                        {% endfor %}
                    {% else %}
                        Aucun rôle attribué. Veuillez contacter l'administrateur.
                    {% endif %}
                </p>
            </div>

            <!-- Section des informations personnelles -->
            <div class="row mb-3">
                <h6 class="text-muted fw-bold mb-2">Informations personnelles</h6>
                <div class="col-md-6">
                    {{ form_row(form.firstName, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
                    {{ form_row(form.lastName, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
                    {{ form_row(form.dateNaissance, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
                </div>

                <div class="col-md-6">
                    {{ form_row(form.email, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
                    {{ form_row(form.numTel, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
                    {{ form_row(form.adresse, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
                </div>
            </div>

            <!-- Section du mot de passe -->
            <div class="form-group mb-4">
                <div class="form-check d-flex align-items-center">
                    <label for="changer_mdp" class="form-check-label text-success me-2" data-bs-toggle="collapse" href="#password-collapse" role="button" aria-expanded="false" aria-controls="password-collapse">
                        <i class="fas fa-lock"></i> Changer mon mot de passe
                    </label>
                    <i class="fas fa-chevron-down" id="password-toggle-icon"></i>
                </div>
            </div>

            <div class="collapse" id="password-collapse">
                <div class="border rounded p-3 mt-2 shadow-sm">
                    {{ form_row(form.password, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
                    {{ form_row(form.confirmPassword, {'attr': {'class': 'form-control shadow-sm rounded-pill'}}) }}
                </div>
            </div>

            <!-- Bouton de soumission -->
            <div class="text-end mt-4">
                <button type="submit" class="btn btn-success btn-lg rounded-pill shadow-sm">
                    Sauvegarder
                </button>
                <a href="{{ path('app_userprofile') }}" class="btn btn-secondary">Annuler</a>
            </div>

            {{ form_end(form) }}
        </div>
    </div>
</div>

<script>
    function previewImage(input) {
        if (input.files && input.files[0]) {
            let reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('imagePreview').src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    }
</script>
{% endblock %}
